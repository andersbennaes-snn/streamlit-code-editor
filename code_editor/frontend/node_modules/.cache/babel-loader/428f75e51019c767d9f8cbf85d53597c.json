{"ast":null,"code":"var _jsxFileName = \"/home/anasbouzid/code-projects/streamlit/custom-components/CodeEditor/code_editor/frontend/src/editor.tsx\",\n  _s = $RefreshSig$();\nimport { useEffect } from \"react\";\nimport AceEditor from \"react-ace\";\nimport ace from \"ace-builds\";\nimport \"ace-builds/webpack-resolver\";\nimport \"ace-builds/src-noconflict/mode-python\";\nimport \"ace-builds/src-noconflict/mode-javascript\";\nimport \"ace-builds/src-noconflict/ext-language_tools\";\nimport \"ace-builds/src-noconflict/ext-searchbox\";\nimport \"ace-builds/src-noconflict/ext-prompt\";\nimport \"ace-builds/src-noconflict/ext-modelist\";\nimport \"ace-builds/src-noconflict/ext-keybinding_menu\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Editor = _ref => {\n  _s();\n  let {\n    lang,\n    theme,\n    shortcuts,\n    props,\n    snippetString,\n    commands,\n    keybindingString,\n    editorRef,\n    code,\n    onChange\n  } = _ref;\n  useEffect(() => {\n    console.log(\"editor mounted\");\n    return () => {\n      console.log(\"editor unmounted\");\n    };\n  }, []);\n  useEffect(() => {\n    console.log(\"~~~~~ useEffect inside Editor ~~~~~\");\n    //console.log(aceEditor.current?.editor);\n    if (editorRef.current) {\n      console.log(editorRef.current.editor.getSession().$modeId);\n      console.log(editorRef.current.editor.commands);\n      ace.require('ace/autocomplete').Autocomplete.for(editorRef.current.editor);\n      const keybindings = JSON.parse(keybindingString);\n      console.log(keybindings);\n      if (keybindings.commands && keybindings.commands.length > 0) {\n        const bindkeySelector = editorRef.current.editor.commands.platform;\n        keybindings.commands.forEach(binding => {\n          // (editorRef.current.editor as ace.Ace.Editor).commands.bindKey(binding.bindkey, binding.name, undefined);\n          // console.log(typeof (editorRef.current.editor.commands as ace.Ace.CommandManager).bindKey)\n\n          if (binding.name && typeof binding.name === \"string\") {\n            if (JSON.stringify(editorRef.current.editor.commands.commands[binding.name].bindKey) !== JSON.stringify(binding.bindkey)) {\n              const newCommand = structuredClone(editorRef.current.editor.commands.commands[binding.name]);\n              newCommand.bindKey = binding.bindkey;\n              commands.push(newCommand);\n            }\n          }\n\n          // if(typeof binding.bindkey === \"string\" || (typeof binding.bindkey === \"object\" && (binding.bindkey as any)[bindkeySelector])){\n          //   editorRef.current.editor.commands.bindKey(binding.bindkey, binding.name);\n          // }\n          // else if(binding.name && typeof binding.name === \"string\") {\n          //   editorRef.current.editor.commands.removeCommand(binding.name, true);\n          // }      \n        });\n      }\n\n      console.log(editorRef.current.editor);\n      if (keybindings.completer && keybindings.completer.length > 0) {\n        const bindkeySelector = editorRef.current.editor.completer.keyboardHandler.platform;\n        keybindings.completer.forEach(binding => {\n          if (typeof binding.bindkey === \"string\" || typeof binding.bindkey === \"object\" && binding.bindkey[bindkeySelector]) {\n            editorRef.current.editor.completer.keyboardHandler.bindKey(binding.bindkey, binding.name);\n          } else if (binding.name && typeof binding.name === \"string\") {\n            editorRef.current.editor.completer.keyboardHandler.removeCommand(binding.name, true);\n          }\n        });\n      }\n      ace.require(\"ace/ext/keybinding_menu\").init(editorRef.current.editor);\n      console.log(editorRef.current.editor);\n      const snippetManager = ace.require('ace/snippets').snippetManager;\n      const snippets = JSON.parse(snippetString);\n      for (const [snippetsLang, snippetsAddRemove] of Object.entries(snippets)) {\n        console.log(\"new snippets\");\n        console.log(snippetsLang);\n        console.log(snippetsAddRemove);\n        if (snippetsAddRemove[0]) {\n          snippetManager.register(snippetManager.parseSnippetFile(snippetsAddRemove[0], snippetsLang), snippetsLang);\n          console.log(snippetManager);\n        } else {\n          console.log(\"Cannot register snippets: check format of snippets\");\n        }\n        if (snippetsAddRemove[1]) {\n          console.log(\"snippets to remove\");\n          console.log(snippetManager.parseSnippetFile(snippetsAddRemove[1], snippetsLang));\n          console.log(snippetManager.parseSnippetFile(snippetManager.files['ace/mode/' + snippetsLang].snippetText, snippetsLang));\n          snippetManager.unregister(snippetManager.parseSnippetFile(snippetsAddRemove[1], snippetsLang), snippetsLang);\n          console.log(snippetManager);\n        } else {\n          console.log(\"Cannot unregister snippets: check format of snippets\");\n        }\n      }\n    } else {\n      console.log(\"No editor to register/unregister snippets to\");\n    }\n  }, [snippetString, keybindingString]);\n  return /*#__PURE__*/_jsxDEV(AceEditor, {\n    ref: editorRef,\n    name: \"REACT_ACE_EDITOR\",\n    mode: lang,\n    theme: theme,\n    value: code,\n    keyboardHandler: shortcuts,\n    commands: commands,\n    onChange: onChange,\n    ...props\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 121,\n    columnNumber: 11\n  }, this);\n};\n_s(Editor, \"3ubReDTFssvu4DHeldAg55cW/CI=\");\n_c = Editor;\nvar _c;\n$RefreshReg$(_c, \"Editor\");","map":{"version":3,"names":["useEffect","AceEditor","ace","Editor","lang","theme","shortcuts","props","snippetString","commands","keybindingString","editorRef","code","onChange","console","log","current","editor","getSession","$modeId","require","Autocomplete","for","keybindings","JSON","parse","length","bindkeySelector","platform","forEach","binding","name","stringify","bindKey","bindkey","newCommand","structuredClone","push","completer","keyboardHandler","removeCommand","init","snippetManager","snippets","snippetsLang","snippetsAddRemove","Object","entries","register","parseSnippetFile","files","snippetText","unregister"],"sources":["/home/anasbouzid/code-projects/streamlit/custom-components/CodeEditor/code_editor/frontend/src/editor.tsx"],"sourcesContent":["import { useEffect} from \"react\"\nimport AceEditor, { ICommandBindKey } from \"react-ace\";\nimport ace from \"ace-builds\";\n\nimport \"ace-builds/webpack-resolver\";\nimport \"ace-builds/src-noconflict/mode-python\";\nimport \"ace-builds/src-noconflict/mode-javascript\";\nimport \"ace-builds/src-noconflict/ext-language_tools\";\nimport \"ace-builds/src-noconflict/ext-searchbox\";\nimport \"ace-builds/src-noconflict/ext-prompt\";\nimport \"ace-builds/src-noconflict/ext-modelist\";\nimport \"ace-builds/src-noconflict/ext-keybinding_menu\";\n\nexport interface KeyBinding {\n    bindkey: string | object,\n    name: string\n}\n\nexport interface EditorKeyBindings {\n  commands?: KeyBinding[],\n  completer?: KeyBinding[]\n}\n\nexport type EditorProps = {\n    code: string,\n    lang: string,\n    theme: string,\n    shortcuts: string,\n    props: any,\n    editorRef: any,\n    snippetString: string,\n    commands: object[],\n    keybindingString: string,\n    onChange: (value: string, event?: any) => void \n  }\n  \nexport const Editor = ({ lang, theme, shortcuts, props, snippetString, commands, keybindingString, editorRef, code, onChange }: EditorProps ) => {\n  \n  useEffect(() => {\n    console.log(\"editor mounted\");\n    return () => {\n      console.log(\"editor unmounted\");\n    }\n  }, []);\n    \n  useEffect(() => {\n    console.log(\"~~~~~ useEffect inside Editor ~~~~~\");\n    //console.log(aceEditor.current?.editor);\n    if(editorRef.current){\n      console.log(editorRef.current.editor.getSession().$modeId);\n      console.log(editorRef.current.editor.commands);\n      \n      ace.require('ace/autocomplete').Autocomplete.for(editorRef.current.editor);\n      const keybindings = JSON.parse(keybindingString) as EditorKeyBindings;\n      console.log(keybindings);\n      if(keybindings.commands && keybindings.commands.length > 0){\n        const bindkeySelector = editorRef.current.editor.commands.platform as string;\n        keybindings.commands.forEach((binding) => {\n            // (editorRef.current.editor as ace.Ace.Editor).commands.bindKey(binding.bindkey, binding.name, undefined);\n            // console.log(typeof (editorRef.current.editor.commands as ace.Ace.CommandManager).bindKey)\n\n            if(binding.name && typeof binding.name === \"string\"){\n              if (JSON.stringify(editorRef.current.editor.commands.commands[binding.name].bindKey) !== JSON.stringify(binding.bindkey)) {\n                const newCommand = structuredClone(editorRef.current.editor.commands.commands[binding.name]);\n                newCommand.bindKey = binding.bindkey;\n                commands.push(newCommand);\n              }\n            }\n\n            // if(typeof binding.bindkey === \"string\" || (typeof binding.bindkey === \"object\" && (binding.bindkey as any)[bindkeySelector])){\n            //   editorRef.current.editor.commands.bindKey(binding.bindkey, binding.name);\n            // }\n            // else if(binding.name && typeof binding.name === \"string\") {\n            //   editorRef.current.editor.commands.removeCommand(binding.name, true);\n            // }      \n        });\n      }\n      console.log(editorRef.current.editor);\n      if(keybindings.completer && keybindings.completer.length > 0){\n        const bindkeySelector = editorRef.current.editor.completer.keyboardHandler.platform as string;\n        keybindings.completer.forEach((binding) => {\n            if(typeof binding.bindkey === \"string\" || (typeof binding.bindkey === \"object\" && (binding.bindkey as any)[bindkeySelector])){\n              editorRef.current.editor.completer.keyboardHandler.bindKey(binding.bindkey, binding.name);\n            }\n            else if(binding.name && typeof binding.name === \"string\") {\n              editorRef.current.editor.completer.keyboardHandler.removeCommand(binding.name, true);\n            }    \n        });\n      }\n      ace.require(\"ace/ext/keybinding_menu\").init(editorRef.current.editor);\n      console.log(editorRef.current.editor);\n      const snippetManager = ace.require('ace/snippets').snippetManager;\n      const snippets = JSON.parse(snippetString) as object;\n      for (const [snippetsLang, snippetsAddRemove] of Object.entries(snippets)){\n        console.log(\"new snippets\")\n        console.log(snippetsLang);\n        console.log(snippetsAddRemove);\n        if(snippetsAddRemove[0]){\n          snippetManager.register(snippetManager.parseSnippetFile(snippetsAddRemove[0], snippetsLang), snippetsLang)\n          console.log(snippetManager);\n        } else {\n          console.log(\"Cannot register snippets: check format of snippets\");\n        }\n        if(snippetsAddRemove[1]){\n          console.log(\"snippets to remove\")\n          console.log(snippetManager.parseSnippetFile(snippetsAddRemove[1], snippetsLang));\n\n          console.log(snippetManager.parseSnippetFile(snippetManager.files['ace/mode/' + snippetsLang].snippetText, snippetsLang));\n          snippetManager.unregister(snippetManager.parseSnippetFile(snippetsAddRemove[1], snippetsLang), snippetsLang)\n          console.log(snippetManager);\n        } else {\n          console.log(\"Cannot unregister snippets: check format of snippets\");\n        }\n      }\n    } else {\n      console.log(\"No editor to register/unregister snippets to\");\n    }\n  }, [snippetString, keybindingString]);\n\n  return (\n          <AceEditor\n          ref={editorRef}\n          name=\"REACT_ACE_EDITOR\"\n          mode={lang}\n          theme={theme}\n          value={code}\n          keyboardHandler={shortcuts}\n          commands={commands}\n          onChange={onChange}\n          {...props} />\n  );\n};"],"mappings":"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"},"metadata":{},"sourceType":"module"}